# Xide åŒºå—é“¾æ•™è‚²å¹³å°åç«¯ API ç³»ç»Ÿ

## é¡¹ç›®ç®€ä»‹

Xide æ˜¯ä¸€ä¸ªåŸºäº Node.js å’Œ SQLite æ„å»ºçš„åŒºå—é“¾æ•™è‚²å¹³å°åç«¯ API ç³»ç»Ÿï¼Œé‡‡ç”¨ RESTful æ¶æ„è®¾è®¡ï¼Œä¸ºå‰ç«¯åº”ç”¨æä¾›å®Œæ•´çš„è¯¾ç¨‹ç®¡ç†ã€ç”¨æˆ·ç®¡ç†å’Œç§¯åˆ†ç³»ç»ŸæœåŠ¡ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ“ è¯¾ç¨‹ç®¡ç†

- **è¯¾ç¨‹åˆ›å»º**: åå°ç®¡ç†å‘˜å¯åˆ›å»ºç›´æ’­è¯¾ç¨‹
- **è¯¾ç¨‹ä¿¡æ¯**: åŒ…å«æ ‡é¢˜ã€è®²å¸ˆã€ä»·å€¼ã€è¯„åˆ†ã€ä¸Šæ¶æ—¶é—´ã€ç›´æ’­æ—¶é—´ã€ç±»åˆ«ç­‰
- **è¯¾ç¨‹æŸ¥è¯¢**: æ”¯æŒåˆ†é¡µã€åˆ†ç±»ç­›é€‰ã€æœç´¢ç­‰åŠŸèƒ½
- **è¯¾ç¨‹çŠ¶æ€**: æ”¯æŒä¸Šæ¶ã€ä¸‹æ¶ã€åˆ é™¤ç­‰çŠ¶æ€ç®¡ç†

### ğŸ‘¤ ç”¨æˆ·ç®¡ç†

- **Web3 é’±åŒ…é›†æˆ**: ä½¿ç”¨é’±åŒ… ID ä½œä¸ºç”¨æˆ·å”¯ä¸€æ ‡è¯†
- **ç”¨æˆ·ä¿¡æ¯**: è®°å½•ç”¨æˆ·åã€é‚®ç®±ã€å¤´åƒç­‰åŸºæœ¬ä¿¡æ¯
- **è¯¾ç¨‹å‚ä¸**: ç”¨æˆ·å¯åŠ å…¥è¯¾ç¨‹å¹¶è®°å½•å­¦ä¹ è¿›åº¦
- **å­¦ä¹ ç»Ÿè®¡**: è·Ÿè¸ªè§‚çœ‹æ—¶é—´ã€å®Œæˆç‡ç­‰å­¦ä¹ æ•°æ®

### ğŸ’° ç§¯åˆ†ç³»ç»Ÿ

- **ç§¯åˆ†è·å–**: å®Œæˆè¯¾ç¨‹ã€å‚ä¸æ´»åŠ¨ç­‰è·å¾—ç§¯åˆ†
- **ç§¯åˆ†æ¶ˆè´¹**: è´­ä¹°è¯¾ç¨‹ã€å…‘æ¢å•†å“ç­‰æ¶ˆè´¹ç§¯åˆ†
- **ç§¯åˆ†æ—¥å¿—**: å®Œæ•´çš„ç§¯åˆ†å˜åŠ¨è®°å½•å’Œå®¡è®¡
- **ç§¯åˆ†ç»Ÿè®¡**: è¯¦ç»†çš„ç§¯åˆ†æ”¶æ”¯ç»Ÿè®¡å’Œè¶‹åŠ¿åˆ†æ

## æŠ€æœ¯æ¶æ„

- **è¿è¡Œç¯å¢ƒ**: Node.js
- **Web æ¡†æ¶**: Express.js
- **æ•°æ®åº“**: SQLite3
- **æ•°æ®éªŒè¯**: Joi
- **å®‰å…¨é˜²æŠ¤**: Helmet, CORS, Rate Limiting
- **æ—¥å¿—è®°å½•**: Morgan

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### courses (è¯¾ç¨‹è¡¨)

- `id`: ä¸»é”®
- `title`: è¯¾ç¨‹æ ‡é¢˜
- `instructor`: è®²å¸ˆå§“å
- `value`: è¯¾ç¨‹ä»·å€¼
- `rating`: è¯„åˆ†
- `rating_count`: è¯„åˆ†äººæ•°
- `publish_time`: ä¸Šæ¶æ—¶é—´
- `live_time`: ç›´æ’­æ—¶é—´
- `category`: è¯¾ç¨‹ç±»åˆ«
- `description`: è¯¾ç¨‹æè¿°
- `cover_image`: å°é¢å›¾ç‰‡
- `status`: è¯¾ç¨‹çŠ¶æ€
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

#### users (ç”¨æˆ·è¡¨)

- `id`: ä¸»é”®
- `wallet_id`: Web3 é’±åŒ… ID (å”¯ä¸€)
- `username`: ç”¨æˆ·å
- `email`: é‚®ç®±
- `avatar`: å¤´åƒ
- `total_points`: æ€»ç§¯åˆ†
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

#### user_courses (ç”¨æˆ·è¯¾ç¨‹è®°å½•è¡¨)

- `id`: ä¸»é”®
- `user_id`: ç”¨æˆ· ID (å¤–é”®)
- `course_id`: è¯¾ç¨‹ ID (å¤–é”®)
- `watch_time`: è§‚çœ‹æ—¶é—´(ç§’)
- `completion_rate`: å®Œæˆç‡(%)
- `points_earned`: è·å¾—çš„ç§¯åˆ†
- `joined_at`: åŠ å…¥æ—¶é—´

#### points_logs (ç§¯åˆ†æ—¥å¿—è¡¨)

- `id`: ä¸»é”®
- `user_id`: ç”¨æˆ· ID (å¤–é”®)
- `course_id`: è¯¾ç¨‹ ID (å¤–é”®ï¼Œå¯é€‰)
- `points_change`: ç§¯åˆ†å˜åŠ¨ (+è·å¾—/-æ¶ˆè´¹)
- `reason`: å˜åŠ¨åŸå› 
- `balance_after`: å˜åŠ¨åä½™é¢
- `created_at`: åˆ›å»ºæ—¶é—´

## API æ¥å£æ–‡æ¡£

### è¯¾ç¨‹ç›¸å…³æ¥å£

#### è·å–è¯¾ç¨‹åˆ—è¡¨

```
GET /api/courses
æŸ¥è¯¢å‚æ•°:
- page: é¡µç  (é»˜è®¤: 1)
- limit: æ¯é¡µæ•°é‡ (é»˜è®¤: 10)
- category: è¯¾ç¨‹ç±»åˆ«
- status: è¯¾ç¨‹çŠ¶æ€ (é»˜è®¤: active)
- search: æœç´¢å…³é”®è¯
```

#### è·å–è¯¾ç¨‹è¯¦æƒ…

```
GET /api/courses/:id
```

#### åˆ›å»ºè¯¾ç¨‹ (åå°ç®¡ç†)

```
POST /api/courses
è¯·æ±‚ä½“:
{
  "title": "è¯¾ç¨‹æ ‡é¢˜",
  "instructor": "è®²å¸ˆå§“å",
  "value": 100.0,
  "live_time": "2024-01-15T10:00:00Z",
  "category": "åŒºå—é“¾åŸºç¡€",
  "description": "è¯¾ç¨‹æè¿°",
  "cover_image": "https://example.com/image.jpg"
}
```

#### æ›´æ–°è¯¾ç¨‹

```
PUT /api/courses/:id
```

#### åˆ é™¤è¯¾ç¨‹

```
DELETE /api/courses/:id
```

#### è·å–è¯¾ç¨‹ç±»åˆ«

```
GET /api/courses/categories
```

### ç”¨æˆ·ç›¸å…³æ¥å£

#### åˆ›å»ºç”¨æˆ·

```
POST /api/users
è¯·æ±‚ä½“:
{
  "wallet_id": "0x1234567890abcdef...",
  "username": "ç”¨æˆ·å",
  "email": "user@example.com",
  "avatar": "https://example.com/avatar.jpg"
}
```

#### è·å–ç”¨æˆ·ä¿¡æ¯

```
GET /api/users/:wallet_id
```

#### æ›´æ–°ç”¨æˆ·ä¿¡æ¯

```
PUT /api/users/:wallet_id
```

#### ç”¨æˆ·åŠ å…¥è¯¾ç¨‹

```
POST /api/users/:wallet_id/join-course
è¯·æ±‚ä½“:
{
  "course_id": 1
}
```

#### è·å–ç”¨æˆ·è¯¾ç¨‹åˆ—è¡¨

```
GET /api/users/:wallet_id/courses
æŸ¥è¯¢å‚æ•°:
- page: é¡µç 
- limit: æ¯é¡µæ•°é‡
```

#### æ›´æ–°å­¦ä¹ è¿›åº¦

```
PUT /api/users/:wallet_id/courses/:course_id/progress
è¯·æ±‚ä½“:
{
  "watch_time": 3600,
  "completion_rate": 75.5
}
```

### ç§¯åˆ†ç›¸å…³æ¥å£

#### è·å–ç”¨æˆ·ç§¯åˆ†ä½™é¢

```
GET /api/points/:wallet_id
```

#### ç”¨æˆ·è·å¾—ç§¯åˆ†

```
POST /api/points/:wallet_id/earn
è¯·æ±‚ä½“:
{
  "points": 100,
  "reason": "å®Œæˆè¯¾ç¨‹å­¦ä¹ ",
  "course_id": 1
}
```

#### ç”¨æˆ·æ¶ˆè´¹ç§¯åˆ†

```
POST /api/points/:wallet_id/spend
è¯·æ±‚ä½“:
{
  "points": 50,
  "reason": "è´­ä¹°é«˜çº§è¯¾ç¨‹",
  "course_id": 2
}
```

#### è·å–ç§¯åˆ†æ—¥å¿—

```
GET /api/points/:wallet_id/logs
æŸ¥è¯¢å‚æ•°:
- page: é¡µç 
- limit: æ¯é¡µæ•°é‡
- type: ç±»å‹ (earn/spend)
```

#### è·å–ç§¯åˆ†ç»Ÿè®¡

```
GET /api/points/:wallet_id/statistics
```

## å®‰è£…å’Œè¿è¡Œ

### ç¯å¢ƒè¦æ±‚

- Node.js >= 14.0.0
- npm >= 6.0.0

### å®‰è£…ä¾èµ–

```bash
npm install
```

### ç¯å¢ƒé…ç½®

å¤åˆ¶ `config.env` æ–‡ä»¶å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®ï¼š

```bash
cp config.env .env
```

### å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

### å¥åº·æ£€æŸ¥

è®¿é—® `http://localhost:10086/health` æ£€æŸ¥æœåŠ¡çŠ¶æ€

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
xide_backend/
â”œâ”€â”€ database/          # æ•°æ®åº“ç›¸å…³
â”‚   â””â”€â”€ database.js    # æ•°æ®åº“è¿æ¥å’Œåˆå§‹åŒ–
â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â””â”€â”€ validation.js  # æ•°æ®éªŒè¯
â”œâ”€â”€ routes/            # è·¯ç”±æ–‡ä»¶
â”‚   â”œâ”€â”€ courseRoutes.js    # è¯¾ç¨‹è·¯ç”±
â”‚   â”œâ”€â”€ userRoutes.js      # ç”¨æˆ·è·¯ç”±
â”‚   â””â”€â”€ pointsRoutes.js    # ç§¯åˆ†è·¯ç”±
â”œâ”€â”€ uploads/           # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”œâ”€â”€ config.env         # ç¯å¢ƒé…ç½®
â”œâ”€â”€ package.json       # é¡¹ç›®é…ç½®
â”œâ”€â”€ server.js          # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â””â”€â”€ README.md          # é¡¹ç›®è¯´æ˜
```

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ `database/database.js` ä¸­æ·»åŠ æ–°çš„æ•°æ®è¡¨
2. åˆ›å»ºå¯¹åº”çš„è·¯ç”±æ–‡ä»¶
3. åœ¨ `server.js` ä¸­æ³¨å†Œæ–°è·¯ç”±
4. æ·»åŠ å¿…è¦çš„æ•°æ®éªŒè¯

### æµ‹è¯•

```bash
npm test
```

## å®‰å…¨ç‰¹æ€§

- **è¾“å…¥éªŒè¯**: ä½¿ç”¨ Joi è¿›è¡Œä¸¥æ ¼çš„æ•°æ®éªŒè¯
- **SQL æ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- **CORS é…ç½®**: é™åˆ¶è·¨åŸŸè¯·æ±‚
- **è¯·æ±‚é™åˆ¶**: é˜²æ­¢ API æ»¥ç”¨
- **å®‰å…¨å¤´**: ä½¿ç”¨ Helmet å¢å¼ºå®‰å…¨æ€§

## éƒ¨ç½²è¯´æ˜

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. è®¾ç½® `NODE_ENV=production`
2. é…ç½®å®‰å…¨çš„ JWT å¯†é’¥
3. è®¾ç½®é€‚å½“çš„ CORS åŸŸå
4. é…ç½®æ•°æ®åº“è·¯å¾„
5. è®¾ç½®åˆç†çš„è¯·æ±‚é™åˆ¶

### Docker éƒ¨ç½²

```dockerfile
FROM node:16-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

- é¡¹ç›®ç»´æŠ¤è€…: Xide Team
- é‚®ç®±: support@xide.com
- é¡¹ç›®åœ°å€: https://github.com/xide/xide_backend

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-01)

- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- å®ç°åŸºç¡€çš„è¯¾ç¨‹ç®¡ç†åŠŸèƒ½
- å®ç°ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ
- å®ç°ç§¯åˆ†ç³»ç»Ÿ
- å®Œæ•´çš„ RESTful API
